name: Discord notifications

on:
  push:
    branches:
      - '**'
  pull_request:
    types: [closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify on push
        if: github.event_name == 'push'
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: bash ./.github/scripts/discord_notify.sh push

      - name: Notify on PR merged
        if: github.event_name == 'pull_request' && github.event.pull_request.merged == true
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_USER: ${{ github.event.pull_request.user.login }}
          MERGED_BY: ${{ github.event.pull_request.merged_by.login }}
        run: bash ./.github/scripts/discord_notify.sh pr_merged
